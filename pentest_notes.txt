## pentest notes 1

1 - https://www.apisecuniversity.com/#courses gratis 

lenguajes: python, request library 

hacking APIs Breaking Web Application 

postman = defaul tool pentesting 

owasp  APIs 


port swigger - web training 

https://portswigger.net/web-security/learning-path


application that need msag - que necesitnan cosas compliance o annual testing 


PCI - 


report tool - 


JIRA tickets - define scope - ROE 


DAST - Dynamic appli security Testing - bURPSUITE 


SLO  - 16 hours to respond - 40 hours to test and create report 


Meetigns -------

issues or support or helping oothers 
credentials 


confidence and explaing the reson why you said what you said 




Remediaation --------------------------

high and critical 




## 2
Notes 2


le pasan un json en formato exportado de postman 

{{}} ES UNA VARIABLE en postman 

APIs pueden tener parametros 



cuando el key tiene una x es un proxy - en Equifax es APG -  load balancer en GCp anti DDOS


content=type 

NO BUSCO VULNERBILIDADES SINO MALCONFIGURATIONS

NO PIDA TOKEN o que este mal el token 


rate limiting es una de las mayores vulnerabilidades OWASP top ten API




UAT - antes de produccion 

si es producion se es mucho mas cauteloso en el testing 


todos los errores se tienen que arreglar 





REPORTING --- 

se observo que... se necesita lo siguiente .....

App ID - es como la cedula 


EXTERNAL PENTESTIG----

misconfigurations y view versions 



Scanner de API vulnerabilidades - bantage prevent 





API university y libro para sacar el checklist para testing 
TCM API pentesting 




OSINT AND INFORMATION GATHERING 

- confluence y google findings 



## 3

Pentesting notes #3


internal Network test 

Qualys ticket and then use it as a baseline 


if not we can use NMAP to enumerate ports and then try to group them for later checking 

in a week


---------------------------------------------------------

WEbapp 

we request the credentials 


from the ticket we can see info from the webapp that help us in the test (scope)

contacts info - phone numbers 

Data category ----> Depending on the datatype/ category the pentest is required 



-------------

we start performing diferent manual test to understand the app and see how it behaves depending on the input 

focus on the priorities and start checking for common vulnerabilities 




broken acces control is common nad critical since scanners cannot detect it 

IDOR

----------------------------------------------------------


SSN - social security number - cedula de US - high priority data! 



 --------------------------------------------------------


Burpsuite enterprise 

automation 
less manual 
automated scans 
history

if you have MFA does not work 

----------------------------------------------------------


very easy to find issues or it does not have 

98% APIs are json only legacy use XML 


APG prxy can change it 


APIs need to talk the same language if not they need a proxy to change the format - NGINX 



----------------------------------------------------------------


fundamentals de Network 
portsweger free - 
coding and scripting 

## 4

notes #4

IDOR

se hace referencia a un objeto sin que se valide la referencia
-ver info de otros users o que no tenemos acceso 

puede ser lateral o horizontal o vertical 

pude ser referencia a un file 


TOOL - extension - Autorize 

cualquier request del proxy el lo va a reenviar con los header que le pongamos 

MUY IMPORTANTE ES ENTENDER LA APPLICACION PARA LUEGO HACKEARLA! 

-----------------------------------------------------------------------------------------------------

sitemap.xml?


esconder objetos en UI no es buena practica 

muy interesante, podemos ir directqamente al API porque no hay controles de seguridad, la seguridad aveces esta solo en el UI 

muchas veces vems que la seguridad se encuentra el el UI pero si logramos acceder all backend podriamos ver que no has seguridad 



las webapps pueden tener authentication but no authorization 



formas de evitarlo?

API tags - rol supervisor y definir roles en el API - Frameworks 


------------------------------------------------------------------------------------------------------------


CSRF 

podemos hacer que el user ejecute unn comando que el no quiere hacer, como cambiar el passwd 


burpsuite 


report tool = pentestrepmaker 

en el tool podemos llenar los fieds y crear reportes de cada vulnerabilidad encontrada y luego crear un PDF file con la info 


## 5

pentesting notes #5

reunion semanal - pair review - presentar un tema 




esta semana fue mucho de management - 


-------------------------------------------------------------------------------------------------------------------------


https://systemweakness.com/api-security-on-google-clouds-apigee-2e7205fd437a

APG puede manejar rate limiting 

es proxy a nivel de APIs

APIGEE es una proteccion estra antes de llegar al API 

APIGEE tambien puede tener AI 

traffic management - podemos cnfigurar ACLs a nivel de APIs

-------------------------------------------------------------------------------------------------------------------------
Authorization - 

can block endpoint methods - PUT - OPTIONS - GET 

x-forwarded-for 




--------------------------------------------------------------------------------------------------------------------------


CUANDO PARAR UN injection?

si los caracteres de injection estan bloqueados (10) ver errores o ver como lo maneja 

si esta bien fij0o no hay nada 


---------------------------------------------------------------------------------------------------------------------------


ZAP es gratis 

reporta information disclosure burpsuite casi no 


BURPSUITE actuolizacion de escaneos esta mejor implementada (salen mas rapido)

----------------------------------------------------------------------------------------------------------------------------


Qualys 

el scan tira muchos y hay que limpiar todo lo que no nos sirva / intentar agrupar lo que se pueda - esto puede tardar 2 semanas 

agregarmos un filtro o varios en excel /gsheets 




log4j - podemos ver el reporte de la bvulnerabilidad y ver loq ue nos dice Qualys



como le fue en es escaneo interno?




## 6



en PCI tenemos aveces que ver una por una los webapps a ver si cumplen con el TLS version minimo 


bitru es utilizado para enviar los credenciales de forma segura, solo quienes deben verlas! 



la aplicacion tenia 3 IDORS


de cada 10 applicaciones casi 8 tienen IDOR! 




SQL injection 


aveces agregando commillas a un serACH puerde crear errores y ensenar informacion sobre SQL o directamente los queries 


con los errores podemos ir a google y encontraremos informacion sobre la base de datos y de ahi usar trageted queryes 



GrafQL 


PUT tambien puede ser malo 

podriamos cambiar contrasenas 




## 7 
pentest notes #7


NOTES:


Todo el equipo estuvo en un meet de SANS / AI 


optimizacion de errores en webapp - TECNICAS DE QA para encontrar errores 


Fuzz testing 



postman can be used to fuzz certain parameters to generate errors and alerts 



podemos testear diferentes parametros al path del API to see if they fail and generate an error 


----------------------------------------------
{
    "naughtyValue": "' OR '1'='1"
  },
  {
    "naughtyValue": " "
  },
  {
    "naughtyValue": "%"

-----------------------------------------------

Podemos usar APIs de prueba para ver 



-----------------------------------------------------------------------------------------------------------------------------------------


We use NMAP para PCI o el qualys scan para ver los resultados de forma menos manual 



ellos se dividen por organizacion o alianzas 

USIS
data analytics 
Equifax worfonce solutions 
canada
GCS 
y otras 


aveces caen retest que podemos hacer o sino podemos devolverlo a la persona anterior 

manager es el que crea los MSAG


-------------------------------------------------------------------------------------------------------------------------------------------

MSAG son los peores tickets y son del diablo 

MSAG son normales sin mucha complegidad pero hay que andar detras de los owners y es cansado 

--------------------------------

## 8

pentest notes #8


In pentesting we try to find as much vulns as posible instead of going to deep 

pentesting tiene una conotacion educativa y no solo porque si 

basarse en global starndards 

todo lo que vayas a reportar tienes que saberlo explicar y demostrar 

penterster demuestra que es explotable 




SSRF -----



el server puede recibir un URL y hacer acciones como escaneos de red y ver purtos abiertos 

desde commands 
o ping /  command injection

in this case the web app was compromised using an API flaw 





comun en APIs 

colabortor de burp - es un listener / who made the resquest and info 

con SSRF se puede aprov echar de la confianza para poder tomar acciones 

podeoms intentar hacer pivoting 


postman was used and for the report he used burp 


the API has a parameter called TARGETENDPOINT= 

IF WE CHANGE THIS PARAMETER THE SERVER CAN PERFORM THE ACTION 



we use CVSS standard - is in NIST - PCI


scope: network or webapp it depends on the vulnerability 

---------------------------------------------------------------------------------------------------

vantage

rate limiting in APIs 


----------------------------------------------------------------------------------------------------
SABIENDO EL PURTO ABIERTO PODRIAMOS INTENTAR ENUMERAR BASADO EN EL RESPONSE 

---------------------------------------------------------------------------------------------------


CSRF 

intervencion del user, podria cambiar contrasenas y demas



-------------------------------------------------------------------------------------------------------------------------


podemos ver tickets viejos para ver que se hizo, siempre se hace 

revisar confluence  doocumentation 

quien fue el ultimo que la probo 

internal OSINT basicamente.

-----------------------------------------------------------------------------------------------------------------

MSAG hay que ser cuidadosos porque aveces la info puede venir mal, siempre hay que confirmar 


-------------------

dependiendo de lo que veamos en response headers podemos determinar si es es low or medium 



podemos encontrar info del API in confluence vemos errores 

creamos un baselne 







## Pentesting notes #9 


aprender es hacer labs y ver contenido 

Montar los labs locales de API pentesting 



-------------------------------------------------------------------------------------------------

web app ---> para probar IDOR usamos Autorized plugging en burpsuite 

podemos fuzzear y depues usar las cookies para intentar entrar a /admin con low priviledges 


en pentesting ya sabeomos los paths entonces solo probamos cookies en burp con Autorized 

---------------------------------------------------------------------------------------------------

USIS 90% tienen MFA 

normalmente en pentesting es harcoded para facilitar 


----------------------------------------------------------------------------------------------------

hay annual y otras son retesting 


------------
si encontramos versiones de algo podemos buscar special hacking inputs (payloads) para esas versiones 

buscamos XXE on injections para esas versiones 

------------------------------------------------------------------------------------------------------

Framework - como trabajar ciertas cosas /  parsing /  funciones que facilitan el brete 

funciones especificas de java 


cunjucto de acciones para hacer las cosas:

conectarse a base de datos por ejemplo 

sirven para no volver a inventar la rueda 
-----------------------------------------------------------------------------------------------------


como aprender sobre APIS RECOMIENDA CODEARLAS? 

---------------

API gateway - poner algo enfrente del API - gcp puede hacer esto 

load balancing - APG proxy 



------------------------------------------------------------------------------------------------------






## pentest #10 



LDAP injection para login 

se puede hacer un bypass 

proff of concept - se intenta hacer bypass tipo 1 = 1 in  sql injection (similar thing)

-------------------------------------------------------------------------------------------------------------------

todo lo que reporta burp se revisa para saber si realmente hay un security flaw 



XML injection -

 injection point - 		vemos si se comunica en XML 
				 vulnerabilidades con deserealizacion - cambios de string a XML (por ejemplo)
				  o que sea una applicacion que se sepa que es vulnerable (CVE) o exploit database 
si vemos errores que muertren XML 


------------------------------------------------------------------------------------------------------------------
primer metodo de enum que usamos son los errores y con eso vemos que podriamos hacer


------------------------------------------------------------------------------------------------------------------

No nos enfocamos en probar vulnerabilidades sino en entender la applicacion y basarnos en el burp report 


------------------------------------------------------------------------------------------------------------------
papel del pentester es maualmente mostrale y darle data a burp para luego correr el scanner y validacion manual del reporte 





burp values:

tentative

firm

certain

false_positive


-------------------------------------------------------------------------------------------------------------

pentest rep maker - herramienta para hacer los reports 


y crea luego tickets en JIRA y service now 

--------------------------------------------------------------------------------------------------------------

canary tokens can be used to test ssrf 

colaborator en burp suite es para montar un server pequeno para probar request y ver informacion sobre el sender 


entre mas info y tools tengas es mejor en pentesting 


-------------------------------------------------------------------------------------------------------------


Network pentest 

Websockets sirven para comunicaciones y live updates en general para mandar info 

non-required service 

algunos websockets si tenian pagina de inicio y se tienen que quitar 

se reporta a partir de mas de un ano de atraso en versiones 


Websockets se pueden testear con burp o con Curl 


Nmap enum-ciphers scripts can be used to check for TLS versions 

----------------------------------------------------------------------------------------------------------------





## pentest notes #11



como podriamos tener un mecanismo de monitoreo de APIs ?
seria posible?
ya se hace?



APGee - se puede usar 

depende lo que estemos usando, es dificil darle tracking 
listar cuantos APIs tenemos y con que trabajamos 


como podemos hacer esto con lo que tenemos?

empezar por la mejor alianza para que sea mas ordenados
o la mas pequena para ver si funciona 



empezar a mapear la superficie! 



vantage tool 

APIs scan - 

usarlo para probar  
----------------------------------------------------------------------------------

Network pentesting 


websockets over TLS

monitoreamos los TLS version de 1.2 en adelante 



-----------------------------------------------------------------------------------


IDOR retest


el cookie de session debe ser valido y pertenecer al usuario 

brken authentication is different 

los problemas en IDOR son Athorization 




como hicieron los jumps para llegar al last machine 


RDP se uso para los jumps 










## pentest shadows #12

todos los dias nos metemos a ver las nuevas vulnerabilidades que se reportan en el Hackerone bugbounty

administrativa:



web inspect de microfocus puede ser el siguiente vuln scanner 

API scan can be done by webinspect 



PCI complience es network pentesting - nos apoyamos en Qualys 




AD pentesting 

NMAP 
responder 
tools especificos de windows 
crackmapexec 


psexec
impacket


empire - crear payloads 


tocaria mas manual en realidad*



dandoles permiso a los pentesters y luego usar bloodhunt parqa mapear el AD 



ustedes tienen permiso de usar qualquier tool dentro del scope de web o si hay limitantes?



nikto - no es muy bueno es muy ruidoso y no encuentra mucho 





fuzzing tiene que estar dentro del scope cuando hacemos en test?

solamente limitantes en appID no tanto procesos de pentesting 


podemos usar bugbountys para probar nuestros pentesting abilities 







## Pentest notes 13

pasan por qualys siempre y hay un team de source code analisis

se hace un escaneo 

archivos encontrados se reportan critical 

------------------------------------------------------------

SSRF


muy utilizada due to cloud 

HTTP request
URL parameter can be changed to point to a our malicious website 

----------------------------------------------------------------

Mass Assigment = access to assign values / create accounts delete them 

Exessive data exposure = more info than needed



-------------------------------------

IDOR puede ser a nivel de cookies
http request 
cualquier lugar de ID con input 
URL 

--------------------------------------------------------

COMO NOS MANTENEMOS AL DIA?

nos mantenemos cubriendo OWASP top 10 

que priorizamos?

las vulnerabilidades que se encuentran manualmente IDORS primero 

nos basamos en el scan report de burp o zap - injections ldap - xml - crossite 


------------------------------------------------------------------------------------

normalmente mantenemos 6 tickets por Q para estar healthy 


login password


si es un PCI - default credentials 

si es webapp pentest - podemos ser mas agresivos - defalt creds - versions 

rapido porque no da chance 









## Pentesting notes #14

API pentesting 

intentamos dividir la tareas en cosas mas pequenas 




---------------------------------------------------------------


JWT token es un 
vimos un jwe que creaba un token 


algunas vulnerabilidades, 

algoritmos en none


podrian haber idors 

informacion sensible en los headers o body 


---------------------------------------------------------


el proxy puede verificar el signature 

para evitar attacks podriamos generar un signature para validar el autenticity del token (integrity)




----------------------------------------------------------

con burpsuite hacemos los testing 

post man seria para ver y ordenar los APIs endpoints 

empezamos quitando la firma para probar 


-------------------------------------------------------

portswigger tiene labs para jwt token attacks 






En APIs vamos ciegos practicamente en web app hay mas contexto 



--------------------------------------------

el dominio del API endpoint se separa en el dominio 

y el equipo al cual pertenece el api

dominio.com/personal/costomer-data-suite/outh/token 



------------------------------------------


cada API es diferente - tratar de segregar es importante y encontrarle el sentido

agrupar por method 


encontrar documentacion sobre el API, para intentar encontrar diagramas 



drupal cms joomla 



----------------------------------------------


PNPT 


OSINT- te dan una pagina de ellos publica - para buscar info sensible - no perdamos tanto tiempo aca 

External pentest - rango de ips- usamos nmap 

interna - active directory - 

pensamos en ambietes reales - tonteras aveces nada muy loco 



como le fue con los recomendations? se puede usar google para esto 


OSCP - d


HTB guided mode ayuda mucho 







## pentest notes #15

in APIs we can try to test un common paths to see if the flow is secuential 

if the flow can be bypassed we report as logic flaw or broken authentication 


remediation: veryfy that the autentication is  PASS 


in APIs things can be done differently to bypass security features


---------------------------------------------------------------------------------------------------

information disclosure is big in APIs 


---------------------------------------------------------------------------------------------------

WAF should protect the different https mothods cause they can be changed to bypass 

example:  change http field from IN_PROGRESS to PASS 



we always try to search previous pentest reports from te app to get insights of what to do or what to test 



------------------------------------------------------------------------------------------------------


looking at fields in the API error handleling can be checked - if the app says invalid user it permits user enumeration 




------------------------------------------------------------------------------------------------------

Also adding many characters in an input field an error can give us data back 



XXE - we can try to see fields in the API and see if we can change parameters and inject xee payloads 


-----------------------------------------------------------------------------------------------

REST APIs


REST es una estructure que define metodos aplicables 


REST define 


SOAP uses XML 

JSON is  the asiest

CSV is hard as fuck! 


APIs can use all of them 






## pentest notes #16


How to start a ticket

---------------------------------------------------------------------------

types of pentesting:


annual

complience - PCI

msag - pentest annual 

firt time prod - ARGG
from prem to cloud - Cloud transformation 
PCI / FISMA - NETWORK PENTEST  --> 
re-test 
significant changes

---------------------------------------------------------------------------

Cookies vs tokens


cookies can be used to keep information about the session - everything actually 


tokens are used only once as an example in an API

APIs do not require session stuff it is more a linear procedure 







-----------------------------------------------------------------------------


In APIs we always try IDORS is the most common vulnerability in the wild 


------------------------------------------------------------------------------


We can try to downgrade the API v2 to v1 and see if they have security misconfigurations 




------------------------------------------------------

fuzzing with shitty payloads can be used to test APIs 


